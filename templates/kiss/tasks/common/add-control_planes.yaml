---
- name: Unpack the node data
  set_fact:
    node: "{{ node_packed | split(':') }}"

- name: Add a control plane host - {{ node[1] }}
  add_host:
    ansible_host: "{{ node[1] }}"
    ansible_host_key_checking: false
    ansible_python_interpreter: /opt/bin/python
    ansible_ssh_host: "{{ node[2] }}"
    ansible_user: kiss
    bin_dir: /opt/bin
    ip: "{{ node[2] }}"
    name: "{{ node[1] }}"
    groups:
      - all
      - "{{ 'kube_node' if node[0] == 'kube_control_plane' else 'all' }}"
      - "{{ node[0] }}"
      - "k8s_cluster_{{ lookup('env', 'kiss_cluster_name_snake_case') }}"
      - "os_{{ lookup('env', 'kiss_os_default') }}"
