---
- name: Provision Power Planes - IPMI Common
  include: power-ipmi-common.yaml

- name: Change boot order to PxE-first for next boot
  when: ipmi.stat.exists
  shell: >
    ctr run --rm
    --device /dev/ipmi0
    "quay.io/ulagbulag-village/netai-cloud-ipmitool:latest"
    "kiss-ipmitool" ipmitool
    chassis bootparam set bootflag force_pxe

# FIXME: wait until ipmitool PR is released to Alpine Linux (ipmitool chassis bootdev floppy options=efiboot,persistent not work): https://github.com/ipmitool/ipmitool/issues/258
- name: Change boot order to PxE-first
  when: ipmi.stat.exists
  shell: >
    ctr run --rm
    --device /dev/ipmi0
    "quay.io/ulagbulag-village/netai-cloud-ipmitool:latest"
    "kiss-ipmitool" ipmitool
    chassis bootdev pxe options=efiboot
  ignore_errors: true
