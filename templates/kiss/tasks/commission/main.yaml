---
- hosts: target
  tasks:
    # Step 1 - Test connection
    - include: ping.yaml
    # Step 2 - Configure base
    - include: hostname.yaml
    # Step 3 - Configure storage
    - include: storage.yaml
    # Step 4 - Configure kernel and system
    - include: system.yaml
    # Step 5 - Configure devices
    - include: power.yaml
    - include: network.yaml

- name: Cleanup all kubernetes data
  when:
    - not kiss_os_exists
    - kiss_os_hot_install
  import_playbook: >
    /kubespray/reset.yml
    reset_confirmation="yes"
  ignore_errors: true

- hosts: target
  tasks:
    - include: submit.yaml
